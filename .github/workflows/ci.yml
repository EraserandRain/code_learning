name: Actions CI
on:
  push:
    branches: ["main"]
  workflow_dispatch:
permissions:
  contents: read
  pages: write
  id-token: write
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  github-pages-react-demo:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          sparse-checkout: |
            frontend/react/product_stock_list

      - name: Install packages and Build
        run: |
          cd frontend/react/product_stock_list
          npm add -g pnpm
          pnpm install
          pnpm build

      - name: Setup Pages
        uses: actions/configure-pages@v3

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: "./frontend/react/product_stock_list/dist"

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2

  # docker-build:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3

  #     - name: Build builder-image
  #       uses: docker/setup-buildx-action@v2
  #       with:
  #         context: .
  #         file: builder.Dockerfile
  #         tags: cproject-builder:latest

  # build-and-test:
  #   needs: docker-build
